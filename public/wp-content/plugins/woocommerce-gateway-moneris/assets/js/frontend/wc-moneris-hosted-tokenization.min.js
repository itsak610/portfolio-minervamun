"use strict";jQuery(document).ready(function(a){var t=null;function e(){a("#wc-moneris-expiry").length&&a("#wc-moneris-expiry").payment("formatCardExpiry")}function o(e){e.addClass("processing"),1!==e.data()["blockUI.isBlocked"]&&e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t=Math.round((new Date).getTime()/1e3),a("#wc-moneris-account-number")[0].contentWindow.postMessage("",wc_moneris_hosted_tokenization_params.hosted_tokenization_url)}function n(e){var o,n;-1!==e.origin.indexOf("moneris.com")&&"string"==typeof e.data&&(o=a.parseJSON(e.data),n=Math.round((new Date).getTime()/1e3)-t,Array.isArray(o.responseCode)||(o.responseCode=[o.responseCode]),o.responseCode=a.map(o.responseCode,function(e){return parseInt(e,10)}),a.get(wc_moneris_hosted_tokenization_params.ajaxurl,{action:"wc_payment_gateway_moneris_handle_hosted_tokenization_response",orderId:wc_moneris_hosted_tokenization_params.order_id,responseCode:o.responseCode.join(","),errorMessage:o.errorMessage,token:o.dataKey,requestTime:n}),(e=a("form.checkout").length?a("form.checkout"):a("form#add_payment_method").length?a("form#add_payment_method"):a("form#order_review")).removeClass("processing").unblock(),Math.max.apply(null,o.responseCode)<50?(a("#wc-moneris-use-new-payment-method").val(o.dataKey),a("#wc-moneris-temp-payment-token").val(1),a("#wc-moneris-card-bin").val(o.bin),e.submit(),a("form.checkout").length||(e.addClass("processing"),1!==e.data()["blockUI.isBlocked"]&&e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}))):(a("#wc-moneris-use-new-payment-method").val(""),a("#wc-moneris-temp-payment-token").val(""),n=[],-1!==o.responseCode.indexOf(943)?n.push(wc_moneris_hosted_tokenization_params.card_number_missing_or_invalid):n.push(wc_moneris_hosted_tokenization_params.general_error),m(e,n)))}function r(){window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent&&window.attachEvent("onmessage",n)}function s(e){if(e.is(".processing"))return!1;var o=a(".payment_method_moneris");if(o.find(".js-sv-wc-payment-gateway-payment-token:checked").val())return!0;var n=[],t=o.find("#wc-moneris-csc").val(),r=a.payment.cardExpiryVal(a("#wc-moneris-expiry").val()),o=(s=r).month<10?"0"+s.month:""+s.month,s=r.year,r=(new Date).getFullYear();return(/\D/.test(o)||/\D/.test(s)||12<o||o<1||s<r||r+20<s)&&n.push(wc_moneris_hosted_tokenization_params.card_exp_date_invalid),void 0!==t&&(t?(/\D/.test(t)&&n.push(wc_moneris_hosted_tokenization_params.cvv_digits_invalid),(t.length<3||4<t.length)&&n.push(wc_moneris_hosted_tokenization_params.cvv_length_invalid)):n.push(wc_moneris_hosted_tokenization_params.cvv_missing)),!(0<n.length)||(m(e,n),!1)}function i(){var e=a("#wc-moneris-use-new-payment-method");return!e||0===e.length||(e.is(":checked")&&!e.val()||e.is('input[type="hidden"]')&&!e.val())}function m(e,o){a(".woocommerce-error, .woocommerce-message").remove(),e.prepend('<ul class="woocommerce-error"><li>'+o.join("</li><li>")+"</li></ul>"),e.removeClass("processing").unblock(),e.find(".input-text, select").blur(),a("html, body").animate({scrollTop:e.offset().top-100},1e3)}function c(){a("input.js-wc-moneris-payment-token").change(function(){var e=a("input.js-wc-moneris-payment-token:checked").val(),o=a("div.js-wc-moneris-new-payment-method-form"),n=a("#wc-moneris-csc").closest(".form-row");e?(o.slideUp(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-last").addClass("form-row-first"),o.after(n))):(o.slideDown(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-first").addClass("form-row-last"),o.find(".js-sv-wc-payment-gateway-credit-card-form-expiry").closest(".form-row").after(n)))}).change(),a("input#createaccount").change(function(){var e=a("input.js-wc-moneris-tokenize-payment-method").closest("p.form-row");a(this).is(":checked")?(e.slideDown(),e.next().show()):(e.hide(),e.next().hide())}).change()}a("form.checkout").length?(r(),a(document.body).on("updated_checkout",function(){c()}),a("form.checkout").bind("checkout_place_order_moneris",function(){return i()?(o(a(this)),!1):s(a(this))})):a("form#add_payment_method").length?(r(),a("form#add_payment_method").on("submit",function(){return a("#wc-moneris-temp-payment-token").val()?s(a(this)):(o(a(this)),!1)})):(c(),r(),a("form#order_review").submit(function(){if("moneris"===a("#order_review input[name=payment_method]:checked").val())return i()?(o(a(this)),!1):s(a(this))})),a(document.body).on("updated_checkout",e),e()});